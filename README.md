# OpenRouter Simple AG - Your Command-Line AI Assistant
è¿™åªæ˜¯ä¸€ä¸ªç”¨ ai ç¼–å†™çš„å°ç©å…·ï¼Œç¨å¾®ç”±æˆ‘æ£€æŸ¥å¹¶ä¸”ä¿®æ”¹äº†å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†ï¼Œéš¾å…ä¼šå­˜åœ¨é—®é¢˜ğŸ˜‚
This is just a toy script generated by AI, intended primarily for easy environment setup. Expect potential rough edges! ğŸ˜‚

`ag` (AI Generalist) is a simple command-line tool written in Fish shell script that allows you to interact with AI models via the OpenRouter API directly from your terminal. It supports streaming responses and managing multiple conversation contexts.

Inspired by the need for a straightforward, terminal-based AI interaction tool without heavy dependencies.

---

**[ä¸­æ–‡è¯´æ˜ (Chinese Description Below)](https://github.com/cry0404/Openrouter-simple-ag/blob/main/README.md#%E4%B8%AD%E6%96%87%E8%AF%B4%E6%98%8E)**

---

## Features

*   **Direct API Interaction**: Communicates with the OpenRouter API (`/chat/completions` endpoint).
*   **Streaming Responses**: Displays AI responses word-by-word as they arrive (plain text only).
*   **Named Context Management**:
    *   Maintain multiple independent conversation histories using simple named files (`-s <name>`).
    *   List available contexts (`-l`).
    *   Delete specific contexts (`-d <name>`).
    *   Default mode is ephemeral (no context loaded or saved).
*   **Customizable**: Easily change the default AI model or API endpoint within the script.
*   **Lightweight**: Primarily relies on `fish`, `curl`, and `jq`.
*   **Easy Setup & Removal**: Includes a setup script for Debian/Ubuntu-based systems with language selection and an uninstall option.

## Installation (Debian/Ubuntu based systems)

An automated setup script is provided to install dependencies and the `ag` function itself.

1.  **Download the Setup Script:**
    ```bash
    # Download directly from this repository
    curl -o setup_ag_tool.sh https://raw.githubusercontent.com/cry0404/Openrouter-simple-ag/main/setup_ag_tool.sh
    # --- OR ---
    # Clone the repository and navigate into it
    # git clone https://github.com/cry0404/Openrouter-simple-ag.git
    # cd Openrouter-simple-ag
    ```

2.  **Make it Executable:**
    ```bash
    chmod +x setup_ag_tool.sh
    ```

3.  **Run the Script:** The script will first ask you to choose a language (English/Chinese) for instructions.
    ```bash
    ./setup_ag_tool.sh
    ```
    The script will install dependencies (`fish`, `jq`, `curl`) using `apt`. It will place the `ag.fish` script in `~/.config/fish/functions/`.
    *   **Note:** Requires Fish Shell version 3.0 or higher.

4.  **Set API Key:** This is crucial! Set your OpenRouter API key as an environment variable. Run this in your terminal and add it to your `~/.config/fish/config.fish` file for persistence:
    ```fish
    set -gx OPENROUTER_API_KEY 'sk-or-v1-YOUR-API-KEY-HERE'
    # (Replace with your actual key)
    ```

5.  **Start a NEW Fish Shell:** Open a new terminal window or type `fish` to start a new session. This ensures the function is loaded.

## Uninstallation

To remove the `ag` tool:

1.  Run the setup script with the `--uninstall` flag:
    ```bash
    ./setup_ag_tool.sh --uninstall
    ```
2.  The script will remove the `ag.fish` function file.
3.  It will then **prompt you** to confirm if you want to remove the context data directory (`~/.local/share/ag_contexts`), which contains all your saved chat histories.
4.  System packages (`fish`, `jq`, `curl`) are **not** automatically removed. You can remove them manually if no longer needed (e.g., `sudo apt remove fish jq curl`).

## Usage

The basic syntax is: `ag [OPTIONS] "YOUR PROMPT"`

**Examples:**

*   Simple query (streaming plain text):
    ```bash
    ag "What is the capital of France?"
    ```

*   Start or continue a named conversation context:
    ```bash
    ag -s learning_fish "What are functions in Fish shell?"
    ag -s learning_fish "How do I define arguments for them?"
    ```

*   List saved contexts:
    ```bash
    ag -l
    ```

*   Delete a context:
    ```bash
    ag -d learning_fish
    ```

*   View help:
    ```bash
    ag -h
    ```

## Configuration

*   **API Key**: Set the `OPENROUTER_API_KEY` environment variable (mandatory).
*   **Model**: Edit the `ag.fish` file (`~/.config/fish/functions/ag.fish`) directly to change the `model_name` variable if desired.
*   **Context Directory**: Context files are stored in `~/.local/share/ag_contexts/`.

## Dependencies

*   **Required**:
    *   `fish` (Shell) Version 3.0 or higher is required.
    *   `jq`
    *   `curl`

## Troubleshooting

*   **Command 'ag' not found or `source: Error while reading file...`**:
    *   Ensure you have started a **new** Fish shell session after running the setup script.
    *   Verify your Fish version: Run `fish --version`. This script requires Fish 3.0 or higher. If your version is older (e.g., 2.x), you need to upgrade Fish shell itself via your system's package manager (e.g., `sudo apt update && sudo apt install fish`).
    *   Check if `~/.config/fish/functions/ag.fish` exists and has the correct content. You might need to re-run the setup script.
*   **Context not saving/loading**: Ensure the context directory (`~/.local/share/ag_contexts/`) and its parent directories are writable by your user. Check the contents of the `.json` files within that directory to see if they are valid JSON arrays.

## Contributing

This is just a small toy generated by AI, there are bound to be many loopholes, feel free to try modifying it to make it more convenient! (è¿™åªæ˜¯ä¸€ä¸ªç”± ai ç”Ÿæˆçš„å°ç©å…·ï¼Œéš¾å…æœ‰è®¸å¤šæ¼æ´ï¼Œä½ å¯ä»¥æ¥å°è¯•ä¿®æ”¹ä½¿å…¶å˜å¾—æ›´åŠ æ–¹ä¾¿ï¼) Feel free to open issues or pull requests if you have suggestions or find bugs!

---

# ä¸­æ–‡è¯´æ˜

`ag` (AI Generalist) æ˜¯ä¸€ä¸ªç”¨ Fish shell è„šæœ¬ç¼–å†™çš„ç®€å•å‘½ä»¤è¡Œå·¥å…·ï¼Œå…è®¸æ‚¨ç›´æ¥ä»ç»ˆç«¯é€šè¿‡ OpenRouter API ä¸ AI æ¨¡å‹è¿›è¡Œäº¤äº’ã€‚å®ƒæ”¯æŒæµå¼å“åº”å’Œç®¡ç†å¤šä¸ªå¯¹è¯ä¸Šä¸‹æ–‡ã€‚

çµæ„Ÿæ¥æºäºå¯¹ä¸€ä¸ªç›´æ¥ã€åŸºäºç»ˆç«¯ã€æ— è¿‡å¤šé‡ä¾èµ–çš„ AI äº¤äº’å·¥å…·çš„éœ€æ±‚ã€‚

---

## åŠŸèƒ½ç‰¹æ€§

*   **ç›´æ¥ API äº¤äº’**: ä¸ OpenRouter API çš„ `/chat/completions` ç«¯ç‚¹é€šä¿¡ã€‚
*   **æµå¼å“åº”**: é€å­—æ˜¾ç¤º AI çš„å“åº”ï¼ˆçº¯æ–‡æœ¬ï¼‰ã€‚
*   **å‘½åä¸Šä¸‹æ–‡ç®¡ç†**:
    *   ä½¿ç”¨ç®€å•çš„å‘½åæ–‡ä»¶ (`-s <åç§°>`) ç»´æŠ¤å¤šä¸ªç‹¬ç«‹çš„å¯¹è¯å†å²ã€‚
    *   åˆ—å‡ºå¯ç”¨çš„ä¸Šä¸‹æ–‡ (`-l`)ã€‚
    *   åˆ é™¤æŒ‡å®šçš„ä¸Šä¸‹æ–‡ (`-d <åç§°>`)ã€‚
    *   é»˜è®¤æ¨¡å¼ä¸ºå³æ—¶å¯¹è¯ï¼ˆä¸åŠ è½½ä¹Ÿä¸ä¿å­˜ä¸Šä¸‹æ–‡ï¼‰ã€‚
*   **å¯å®šåˆ¶**: å¯åœ¨è„šæœ¬ä¸­è½»æ¾æ›´æ”¹é»˜è®¤ AI æ¨¡å‹æˆ– API ç«¯ç‚¹ã€‚
*   **è½»é‡çº§**: ä¸»è¦ä¾èµ– `fish`, `curl`, `jq`ã€‚
*   **æ˜“äºè®¾ç½®ä¸ç§»é™¤**: ä¸ºåŸºäº Debian/Ubuntu çš„ç³»ç»Ÿæä¾›äº†ä¸€é”®å®‰è£…è„šæœ¬ï¼ˆå¸¦è¯­è¨€é€‰æ‹©ï¼‰å’Œå¸è½½é€‰é¡¹ã€‚

## å®‰è£… (åŸºäº Debian/Ubuntu çš„ç³»ç»Ÿ)

æä¾›äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–å®‰è£…è„šæœ¬æ¥å®‰è£…ä¾èµ–é¡¹å’Œ `ag` å‡½æ•°æœ¬èº«ã€‚

1.  **ä¸‹è½½å®‰è£…è„šæœ¬:**
    ```bash
    # ç›´æ¥ä»æœ¬ä»“åº“ä¸‹è½½
    curl -o setup_ag_tool.sh https://raw.githubusercontent.com/cry0404/Openrouter-simple-ag/main/setup_ag_tool.sh
    # --- æˆ–è€… ---
    # å…‹éš†ä»“åº“å¹¶è¿›å…¥ç›®å½•
    # git clone https://github.com/cry0404/Openrouter-simple-ag.git
    # cd Openrouter-simple-ag
    ```

2.  **ä½¿å…¶å¯æ‰§è¡Œ:**
    ```bash
    chmod +x setup_ag_tool.sh
    ```

3.  **è¿è¡Œè„šæœ¬:** è„šæœ¬ä¼šé¦–å…ˆæç¤ºæ‚¨é€‰æ‹©å®‰è£…è¯­è¨€ (è‹±æ–‡/ä¸­æ–‡)ã€‚
    ```bash
    ./setup_ag_tool.sh
    ```
    è„šæœ¬å°†ä½¿ç”¨ `apt` å®‰è£…ä¾èµ–é¡¹ (`fish`, `jq`, `curl`)ã€‚å®ƒä¼šå°† `ag.fish` è„šæœ¬æ”¾ç½®åœ¨ `~/.config/fish/functions/`ã€‚
    *   **æ³¨æ„ï¼š**éœ€è¦ Fish Shell 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚

4.  **è®¾ç½® API å¯†é’¥:** éå¸¸é‡è¦ï¼å°†æ‚¨çš„ OpenRouter API å¯†é’¥è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ã€‚åœ¨ç»ˆç«¯ä¸­è¿è¡Œæ­¤å‘½ä»¤ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„ `~/.config/fish/config.fish` æ–‡ä»¶ä¸­ä»¥æŒä¹…åŒ–ï¼š
    ```fish
    set -gx OPENROUTER_API_KEY 'sk-or-v1-ä½ çš„APIå¯†é’¥æ”¾åœ¨è¿™é‡Œ'
    # (æ›¿æ¢ä¸ºæ‚¨çš„çœŸå®å¯†é’¥)
    ```

5.  **å¯åŠ¨ä¸€ä¸ªæ–°çš„ Fish Shell:** æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£æˆ–è¾“å…¥ `fish` æ¥å¯åŠ¨æ–°ä¼šè¯ã€‚è¿™ç¡®ä¿å‡½æ•°è¢«åŠ è½½ã€‚

## å¸è½½

è¦ç§»é™¤ `ag` å·¥å…·ï¼š

1.  ä½¿ç”¨ `--uninstall` æ ‡å¿—è¿è¡Œå®‰è£…è„šæœ¬ï¼š
    ```bash
    ./setup_ag_tool.sh --uninstall
    ```
2.  è„šæœ¬å°†ç§»é™¤ `ag.fish` å‡½æ•°æ–‡ä»¶ã€‚
3.  ç„¶åå®ƒä¼š**æç¤ºæ‚¨**ç¡®è®¤æ˜¯å¦è¦ç§»é™¤ä¸Šä¸‹æ–‡æ•°æ®ç›®å½• (`~/.local/share/ag_contexts`)ï¼Œè¯¥ç›®å½•åŒ…å«æ‰€æœ‰å·²ä¿å­˜çš„èŠå¤©è®°å½•ã€‚
4.  ç³»ç»Ÿè½¯ä»¶åŒ… (`fish`, `jq`, `curl`) **ä¸ä¼š**è¢«è‡ªåŠ¨ç§»é™¤ã€‚å¦‚æœä¸å†éœ€è¦ï¼Œæ‚¨å¯ä»¥æ‰‹åŠ¨ç§»é™¤å®ƒä»¬ (ä¾‹å¦‚ `sudo apt remove fish jq curl`)ã€‚

## ä½¿ç”¨æ–¹æ³•

åŸºæœ¬è¯­æ³•: `ag [é€‰é¡¹] "ä½ çš„æç¤º"`

**ç¤ºä¾‹:**

*   ç®€å•æŸ¥è¯¢ (æµå¼çº¯æ–‡æœ¬):
    ```bash
    ag "æ³•å›½çš„é¦–éƒ½æ˜¯å“ªé‡Œï¼Ÿ"
    ```

*   å¼€å§‹æˆ–ç»§ç»­ä¸€ä¸ªå‘½åå¯¹è¯ä¸Šä¸‹æ–‡:
    ```bash
    ag -s å­¦ä¹ fish "Fish shell ä¸­çš„å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿ"
    ag -s å­¦ä¹ fish "å¦‚ä½•ä¸ºå®ƒä»¬å®šä¹‰å‚æ•°ï¼Ÿ"
    ```

*   åˆ—å‡ºå·²ä¿å­˜çš„ä¸Šä¸‹æ–‡:
    ```bash
    ag -l
    ```

*   åˆ é™¤ä¸€ä¸ªä¸Šä¸‹æ–‡:
    ```bash
    ag -d å­¦ä¹ fish
    ```

*   æŸ¥çœ‹å¸®åŠ©:
    ```bash
    ag -h
    ```

## é…ç½®

*   **API å¯†é’¥**: å¿…é¡»è®¾ç½® `OPENROUTER_API_KEY` ç¯å¢ƒå˜é‡ã€‚
*   **æ¨¡å‹**: å¯ç›´æ¥ç¼–è¾‘ `ag.fish` æ–‡ä»¶ (`~/.config/fish/functions/ag.fish`) æ¥æ›´æ”¹ `model_name` å˜é‡ã€‚
*   **ä¸Šä¸‹æ–‡ç›®å½•**: ä¸Šä¸‹æ–‡æ–‡ä»¶å­˜å‚¨åœ¨ `~/.local/share/ag_contexts/`ã€‚

## ä¾èµ–

*   **å¿…éœ€**:
    *   `fish` (Shell) éœ€è¦ 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
    *   `jq`
    *   `curl`

## é—®é¢˜æ’æŸ¥

*   **Command 'ag' not found æˆ– `source: Error while reading file...`**:
    *   ç¡®ä¿åœ¨è¿è¡Œå®‰è£…è„šæœ¬åå·²å¯åŠ¨**æ–°çš„** Fish shell ä¼šè¯ã€‚
    *   éªŒè¯æ‚¨çš„ Fish ç‰ˆæœ¬: è¿è¡Œ `fish --version`ã€‚æ­¤è„šæœ¬éœ€è¦ Fish 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å¦‚æœæ‚¨çš„ç‰ˆæœ¬è¾ƒæ—§ (ä¾‹å¦‚ 2.x)ï¼Œæ‚¨éœ€è¦é€šè¿‡ç³»ç»Ÿçš„åŒ…ç®¡ç†å™¨å‡çº§ Fish shell (ä¾‹å¦‚ `sudo apt update && sudo apt install fish`)ã€‚
    *   æ£€æŸ¥ `~/.config/fish/functions/ag.fish` æ˜¯å¦å­˜åœ¨ä¸”å†…å®¹æ­£ç¡®ã€‚æ‚¨å¯èƒ½éœ€è¦é‡æ–°è¿è¡Œå®‰è£…è„šæœ¬ã€‚
*   **ä¸Šä¸‹æ–‡æœªä¿å­˜/åŠ è½½**: ç¡®ä¿ä¸Šä¸‹æ–‡ç›®å½• (`~/.local/share/ag_contexts/`) åŠå…¶çˆ¶ç›®å½•å¯¹æ‚¨çš„ç”¨æˆ·å¯å†™ã€‚æ£€æŸ¥è¯¥ç›®å½•ä¸‹çš„ `.json` æ–‡ä»¶å†…å®¹æ˜¯å¦ä¸ºæœ‰æ•ˆçš„ JSON æ•°ç»„ã€‚

## è´¡çŒ®

è¿™åªæ˜¯ä¸€ä¸ªç”± ai ç”Ÿæˆçš„å°ç©å…·ï¼Œéš¾å…æœ‰è®¸å¤šæ¼æ´ï¼Œä½ å¯ä»¥æ¥å°è¯•ä¿®æ”¹ä½¿å…¶å˜å¾—æ›´åŠ æ–¹ä¾¿ï¼
